#
#
PROG =	Unimod
###################################################

include Makefile.SRCS

###################################################
## module load intel/11.1u8 openmpi/1.4.3.intel
INTEL = /site/VERSIONS/intel-11.1u8
NETCDF = /usit/titan/u1/alfgr/netcdf-3.6.1

LIBS = -lirc -lnetcdf
INCL = -I$(NETCDF)/include -I$(INTEL)/include/intel64
LLIB = -L$(NETCDF)/lib -L$(INTEL)/lib/intel64 -lirc

##LDFLAGS  = -convert big_endian -r8 -O2 -msse2 -ipo -ip -static-libgcc $(DEBUG_FLAGS)
##F90FLAGS = $(LDFLAGS) $(INCL) -static -unroll -align

#DEBUG_FLAGS = -debug-parameters all -traceback -ftrapuv -g -fpe0 -O0 -check bounds
#DEBUG_FLAGS += -check uninit -check pointers -opt_report
F90 = mpif90
LDFLAGS = -r8 -recursive -convert big_endian -IPF_fp_relaxed -shared-intel \
          $(if $(DEBUG_FLAGS),$(DEBUG_FLAGS),-O3 -ftz)
F90FLAGS = $(LDFLAGS) -cpp $(INCL)
LD = $(F90)

## module load netcdf.gfortran4
# NETCDF = /site/netcdf/AuthenticAMD-x86_64/gfortran4
# F90 = mpif90 -ccl gfortran
# LDFLAGS =  -fdefault-real-8 -O3 -Wall -ffixed-line-length-none -fbounds-check -pedantic -fimplicit-none
# F90FLAGS =  $(LDFLAGS) $(INCL)
# LD = gfortran

makedepf90 = /usit/titan/u1/mifapw/bin/makedepf90

.SUFFIXES: $(SUFFIXES)  .f90

.f90.o:
	$(F90) $(F90FLAGS) -c $<

all: .depend $(PROG)

# Include the dependency-list created by makedepf90 below
include .depend

obj: .depend $(FOBJ)

depend .depend: $(SRCS)
	$(makedepf90) $+ -o '$$(PROG)' \
	-l '$$(F90) $$(LDFLAGS) $$(INCL) $$(LLIB) $$+ -o $$@ $$(LIBS)' > .depend

clean: diskclean touchdepend depend module

diskclean:
	rm -f $(PROG) *.o *.mod

touchdepend:
	touch .depend

module:
	@echo -e "Remeber: before compilation & run\n\tmodule load intel/11.1u8 openmpi/1.4.3.intel"
##########################################################
