\chapter{Output files}
\label{ch:output}

Output files from a model run are written out in either ASCII, or
(for most data outputs) in netCDF format. 
The different netCDF files, the Runlog output, and the zipped sites and sondes 
files are named after the runlabel1 parameter set in modrun.sh. 
The model output is written to the same directory as where you submitted 
your run with the modrun.sh script, as described in Chapter \ref{ch:SubmitARun}.
 


\begin{table}[h!]
\caption[List of model output files]{List of output files written in the
  working directory after a  model run. 
Note: YY: year, MM: month.}\label{tab:output}
% \vspace{0.5cm}
\begin{center}
\hspace{-1cm}
\begin{tabular}{lll}
\hline
{\bf Output data files} &  {\bf Short description} & {\bf Format}\\
\hline
    Base\_day.nc & Gridded daily values of a selection & netCDF\\
&   of compounds.& \\ 
    Base\_hour.nc &Gridded hourly values of a selection &
    netCDF\\  
 &  of compounds.& \\
    Base\_inst.nc &Gridded instantaneous values of a selection
     & netCDF\\
 &  of compounds.& \\
    Base\_month.nc & Gridded monthly values of a selection&
    netCDF\\
 &  of compounds.& \\
    Base\_fullrun.nc & Gridded yearly values of a selection&
    netCDF\\
 &  of compounds. & \\
    sites.MMYY & Surface daily values of a selection&  ASCII\\
 & of stations and compounds per month.& \\
    Base.sites.tgz & All the 'sites.MMYY' files in one zipped tar file. & ASCII\\
    sondes.MMYY & Vertical daily values of a selection& ASCII\\
 &  of stations and compounds per month.& \\
    Base.sondes.tgz& All the 'sondes.MMYY' files in one zipped tar file.& ASCII\\ 
& &\\ \hline
{\bf Additional files} &  {\bf Short description} & {\bf Format}\\
    Base\_RunLog & Total emissions of different air   & ASCII\\
 & pollutants per country& \\
eulmod.res & Mass budget for different compounds & ASCII\\
% INPUT.PARA & List of input parameters & ASCII\\\hline
% Remove.sh & Removes the links to the input data at the& ASCII\\
% & end of the run&\\\hline
Timing.out & Timing log file& ASCII \\
 
\hline
\end{tabular}
\end{center}

\label{Tab:outputs}
\end{table}


\newpage
\section{ASCII outputs: sites and sondes}\label{sec:sitesonde}


Two main options are available for the output of ASCII files for comparison
with measurements or detailed model analysis. These are

\begin{description}
\item[sites]  

      output of surface concentrations for a set of specified
      measurement site locations.
\item[sondes] 

      output of concentrations for the vertical column above
     a set of specified locations.
\end{description}

Both sites and sondes are specified and handled in similar ways, in
the module {\bf Sites\_ml.f90}, so we treat them both together below.
Locations are specified in the input files ``sites.dat'' and ``sondes.dat''. 
The files start with a description of its content
followed by a list of the stations. For example, a sondes.dat file
may look like this:

\begin{small}
\begin{quote}
\begin{verbatim}
# "Sondes: names, locations, elevations"
# "Area: Northern Hemisphere"
# "latitude in degrees (positive north)"
# "longitude in degrees (positive east of Greenwich)"
: Units deg
: Coords LatLong
: VertCoords EMEPsigma
: DomainName Hemis
#
name lat long lev #HEADERS
-    deg deg level #SKIP
#DATA:
Uccle             50.80    4.35  20  ! comment
Lerwick           60.13   -1.18  20  ! comment
Sodankyla         67.39   26.65  20  ! comment
Ny_Alesund        78.93   11.88  20  ! comment
Hohenpeissenberg  47.80   11.02  20  ! comment
\end{verbatim}

\end{quote}
\end{small}

Or, in cases where grid inidicies are used rather than latitudes and 
longitudes. This is useful if you want sites and sonde output from a line 
or an area from the model. 

\begin{small}
\begin{quote}
\begin{verbatim}
# "Sites: names, locations, elevations"
# "Area: EMEP-EECCA"
# "ix: x coordinate"
# "iy: y coordinate"
# "lev: vertical coordinate (20=ground)"
: Units index
: Coords ModelCoords
: VertCoords EMEPsigma
: DomainName EMEP-50kmEECCA
#
name ix iy lev #HEADERS
-    index index level #SKIP
#DATA:

\end{verbatim}

\end{quote}
\end{small}

The first line in each file is a header with file content.
Then, the contents are described in more detail. Text strings after
\# are just clarifying comments. 'Area', e.g., is the domain to which
the stations belong, e.g. 'Northern Hemisphere'.

Text after ':' is read in by the model:\newline
- Units: either 'deg' (degrees) or 'index' (model grid indices)\newline
- Coords: either 'LatLong' (latitudes/longitudes) or 'ModelCoords'
(indices of the grid box in which the station is located)\newline
- VertCoords: vertical coordinate system that is used in the model (usually
'EMEPsigma')\newline
- DomainName: domain, for which the model is run (e.g. 'Global\_1x1' or 'Hemis')\newline


Both sites.dat and sondes.dat files are optional, but recommended. 
The species and meteorological data requested for site and sone output
 are specified in {\bf My\_Outputs.f90} by the use of arrays. Only a 
few met fields are defined so far but more can be added into 
{\bf Sites\_ml.f90} as required. The outputs consist
of a header giving the number of sites requested, species/met data requested, and
then the actual values for each variable for each staion. For the sonde data
values are given for all 20 levels, starting with the ground-level values.




\section{NetCDF outputs, Derived fields}

%{\bf modules My\_Derived\_ml, Derived\_ml }\\

% My\_Derived\_ml:\\
% \begin{itemize}
%   \item Constructs arrays wanted\_deriv2d, wanted\_deriv3d, listing
%    the outputs which the user wants in netcdf fields.
% \end{itemize}
% 
% Derived\_ml:\\
% \begin{itemize}
%   \item Contains definitions of possible output fields
%   \item Allocates data arrays d\_2d and d\_3d for those
%     fields which were requested in My\_Derived\_ml	
% \end{itemize}

The netCDF output files can contain both 2D and 3D data fields. The module 
{ \bf Derived\_ml.f90 } contains an extensive set of predefined outputs. 
The user may choose which of these possible data fields should be written 
into the output files by modifying the module called { \bf My\_Derived\_ml.f90}.\\

Most data fields are defined by the array OutputConcs. A defined output 
field for ozone in ppb is for example given  as:
\begin{quote}
\begin{verbatim}
 typ_s5i("O3        ", "ppb", D2,"AIR_CONCS", SPEC, D),& 
\end{verbatim}
\end{quote}
This will give a 'SURF\_ppb\_O3' 2-dimensional surface field in the output netCDF file for 
the fullrun, monthly and daily output. 
Setting the dimensions to D3 will give an additional 3-dimensional field. 


Other arrays where output fields are given are D2\_SR, D2\_EXTRA,\
 VEGO3\_WANTED and 
WDEP\_WANTED. Other fields are also defined in { \bf My\_Derived\_ml.f90 } e.g. for dry 
depositions, emissions, canopy etc. \\



Note that by default the maximum field of 2- and 3-dimensional output field are 
restricted to 200 and 5 respectively. These can be changed with MAX\_NUM\_DERIV2D and MAX\_NUM\_DERIV3D 
in { \bf My\_Derived\_ml.f90 }.


The output frequency is set in { \bf Derived\_ml.f90 }, for example for the surface fields:
\begin{quote}
\begin{verbatim}
 call AddNewDeriv( "PSURF ","PSURF",  "SURF","-",   "hPa", &
               -99,  -99,  F,  1.0,  T,   IOU_DAY )
\end{verbatim}
\end{quote}
 Where the IOU\_DAY setting gives the field in the fullrun.nc, month.nc in addition to the day.nc 
model output files. IOU\_MON gives the field in the fullrun.nc and the month.nc file. 



