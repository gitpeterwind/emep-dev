\tolerance = 10000
%\documentstyle[a4,preprint,revtex]{aps}
\documentstyle[a4]{article}
\parskip=3ex

\begin{document}

                 


{\Huge Derivation of vertical wind from continuity equation}



\vspace{1cm}

\author{Peter Wind}



The continuity equation (in hybrid coordinates) can be written:
(see also http://www.ecmwf.int/research/ifsdocs/DYNAMICS/Chap2\_Discretization3.html\#959545)

\begin{eqnarray} \nonumber
\frac{\partial}{\partial t}\left(\frac{\partial p}{\partial \eta}\right)+\nabla \cdot \left({\bf v_H} \frac{\partial p}{\partial \eta}\right)+\frac{\partial }{\partial \eta}\left(\dot \eta \frac{\partial p}{\partial \eta}\right) = 0
\end{eqnarray}

Integration over $\eta  $ from top to surface gives:

\begin{eqnarray} \nonumber
\frac{\partial P_{surf}}{\partial t}= -\int\limits_{0}^{1}  \nabla \cdot \left({\bf v_H} \frac{\partial p}{\partial \eta}\right) d\eta
\end{eqnarray}
or in discrete form down to level k:

\begin{eqnarray} \nonumber
\dot \eta \frac{\partial p}{\partial \eta}{\Bigg \vert_{k+\frac{1}{2}}} = -\frac{\partial p_{k+\frac{1}{2}}}{\partial t}-\sum_{j=top}^{k} \nabla \cdot \left({\bf v_j} \Delta p_j\right)
\end{eqnarray}

For one level
\begin{eqnarray} \nonumber
\dot \eta \frac{\partial p}{\partial \eta}{\Bigg \vert_{k+\frac{1}{2}}} - \dot \eta \frac{\partial p}{\partial \eta}{\Bigg \vert_{k-\frac{1}{2}}}= -\frac{\partial (p_{k+\frac{1}{2}}-p_{k-\frac{1}{2}})}{\partial t}- \nabla \cdot \left({\bf v_k} \Delta p_k\right)
\end{eqnarray}


For coordinates where the pressure is defined by

\begin{eqnarray} \nonumber
P_k=A_k+B_k P_{surf}
\end{eqnarray}

\begin{eqnarray} \nonumber
\frac{\partial p_{k}}{\partial t}=B_k\frac{\partial P_{surf}}{\partial t}=-B_k\sum_{j=top}^{surf} \nabla \cdot \left({\bf v_j} \Delta p_j\right)
\end{eqnarray}

And we get a recursive expression for the vertical wind $\dot \eta$:
\begin{eqnarray} \nonumber
\dot \eta \frac{\partial p}{\partial \eta}{\Bigg \vert_{k-\frac{1}{2}}} = \dot \eta \frac{\partial p}{\partial \eta}{\Bigg \vert_{k+\frac{1}{2}}} -\Delta B_k\sum_{j=top}^{surf} \nabla \cdot \left({\bf v_j} \Delta p_j\right) + \nabla \cdot \left({\bf v_k} \Delta p_k\right)
\end{eqnarray}

At each level we add two contributions, and at the top this becomes:
\begin{eqnarray} \nonumber
\dot \eta \frac{\partial p}{\partial \eta}{\Bigg \vert_{top}} = -\left(\sum_{k=top}^{surf}\Delta B_k \right)\sum_{j=top}^{surf} \nabla \cdot \left({\bf v_j} \Delta p_j\right) + \sum_{k=top}^{surf} \nabla \cdot \left({\bf v_k} \Delta p_k\right)
\end{eqnarray}

Which is zero since $\left(\sum_{k=top}^{surf}\Delta B_k \right)=1$

We have assumed:
$\dot \eta_{surf}= \dot \eta_{top}=0$, $B_{top}=0$ and $ B_{surf}=1$

If $B_{top}\neq 0$, we can still enforce $\dot\eta_{top}=0$ by the normalization
\begin{eqnarray} \nonumber
\Delta B_k=\frac{\Delta B_k}{\sum_{k=top}^{surf}\Delta B_k}=\frac{\Delta B_k}{B_{surf}-B_{top}}
\end{eqnarray}
\end{document}



